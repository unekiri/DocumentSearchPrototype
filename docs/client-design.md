## 1. 今回実現予定の機能

### 1-1. 金入設計書取込機能（OCR）
ご要件（議事録より）
- 市町村の積算データはPDF（文字情報なし）や紙をPDF化したもので提供される場合がある。
- OCRで文字情報に変換し、検索・突合可能な状態にしたい。

提案内容
- ブラウザからPDFをアップロードし、Azureストレージに格納する。
- テキスト層がないPDFや紙スキャンはOCR対象とし、検索インデックスへ反映する。

### 1-2. 検索機能
ご要件（議事録より）
- 年度や工種などで絞り込みしたい。
- OR検索での条件指定ができる。

提案内容
- 検索条件はフリー入力とし、OR検索に対応する（空白区切り＝OR扱いとする）。
- Azure AI Searchに対して検索を実行し、ファイル名・ページ番号を返す（信頼度の高い順に降順で並べる）。
- 検索結果を押下すると、金入設計書（PDF）を開く（SAS発行）。

### 1-3. 突合機能（CSV × 金入設計書）
ご要件（議事録より）
- アトラスネクストのCSVと市町村の積算データを突合し、単価などの違いに対してタグを付けたい。

提案内容
- CSVをDB（Azure SQL/Cosmos DB）に取り込む。
- OCRで抽出したキー情報（工事番号/工事件名/年度/発注者など）に一致する金入設計書と突合する。
- 突合結果から 単価等の差分を検知し、差分内容に応じたタグを金入設計書に付与する。

## 2. 現状プロトタイプでできていること

### 2-1. 金入設計書取込（OCR）
- ブラウザからPDFをアップロードし、Azureストレージに保存する機能。

### 2-2. 検索
- Azure AI Searchへの検索リクエスト機能。
- 検索結果をファイル単位で一覧表示し、最も関連性の高いページと関連ページ番号の一覧を表示する。
- 検索結果を押下するとSASでPDFを開ける。

### 2-3. 突合（CSV × 金入設計書）
- CSVの取込・突合ロジックは共に未実装。
- 差分に対する金入設計書へのタグ付けも未実装。

## 3. 確認事項（質問）

### 3-1. 金入設計書取込（OCR）
- 最大ファイルサイズ/ページ数の上限はありますか。

### 3-2. 検索

### 3-3. 突合（CSV × 金入設計書）
- CSVに必ず含まれるキー（工事番号/設計書番号/工事件名など）は何ですか。
- 金入設計書側にも同じキーが必ず記載されていますか。
- 突合と判断する条件は何ですか（完全一致/類似一致の基準や閾値）。
- 差分としてタグ付けする項目は何ですか（単価/数量/金額など）。
- 一致しない、または複数一致する場合はエラー判定で良いですか。
